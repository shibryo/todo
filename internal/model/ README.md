# Model
modelを記述するために意識していることを記述する。

参考に、Modelで記述するべきことをWikipediaのMVCモデルの記述から引用する
> そのアプリケーションが扱う領域のデータと手続き（ビジネスロジック - ショッピングの合計額や送料を計算するなど）を表現する要素である。また、データの変更をビューに通知するのもモデルの責任である（モデルの変更を通知するのにObserver パターンが用いられることもある）。

データと手続きを表現することについては意識して設計した。
データの変更をビューに通知することについてはまだ理解できてない。

データと手続きをModelとして表すことで、コードにTodoアプリで行えることを表現することができます。
Todoの仕様変更があった場合でも、Modelを変更するだけで良いので変更容易性が高い状態を保てます。

## エンティティ
エンティティは業務ロジックで扱われる対象をモデル化したものであり、IDなどで一意に特定されるモノである。
このアプリではTodoです。Todoは作成されるたびに違ったIDを持ち、IDが違えば別物として扱います。
Todoの状態がどのように変わるかを表現するために最初に作成しました。
DDDの文脈を参考にしています。

```go
type Todo struct {
	ID         ID 	   `bun:"id"`
	Title      Title       `bun:"title"`
	Completed  Completed   `bun:"completed"`
	LastUpdate LastUpdate  `bun:"last_update"`
	CreatedAt  CreatedAt   `bun:"created_at"`
}
```

## 値オブジェクト
値オブジェクトはエンティティを表現するために必要な要素を、標準の型（int, string）ではなく独自の型（値）として表現したものです。
なぜ独自の型を作成する必要があるかという理由は「現場で役立つシステム設計の原則 〜変更を楽で安全にするオブジェクト指向の実践技法」という本に以下のように示されています。
> このように計算結果も含めて、数量が1以上で100以下であるように制限したQuantityクラスを用意することで、数量計算が安全で確実になります。

> 値の種類ごとに専用の型を用意するとコードが安定し、コードの意図が明確になります。このように、値を扱うための専用クラスを作るやり方を値オブジェクト（ValueObject）と呼びます。業務アプリケーションでよく使う値オブジェクトを表に示します。どの値オブジェクトも、int型／String型／LocalDate型など基本データ型のインスタンス変数を1つか2つ持つだけの小さなクラスです。


例えは、以下のコードのように新規作成時の処理を書くことで、値の取りうる範囲を限定できます。
その結果、値の性質がコードで表現できます。
また、値オブジェクトは不変として運用にすることで、値オブジェクトの信頼性が増します。
```go
func NewTitle(text string) (*Title, error) {
    if len(text) == 0 {
        return nil, fmt.Errorf("title is empty")
	}
	if len(text) > 100 {
        return nil, fmt.Errorf("title is too long")
	}

	return &Title{text: text}, nil
}
```

値オブジェクトは値を表現するためのものなので、IDなど一意に判別できるものを持たせません。
値オブジェクトの持つ値が同じであれば同一のものと考えます。

参考：
Value Object は不変にする | システム設計日記
https://masuda220.jugem.jp/?eid=308

参考：
https://blog.j5ik2o.me/entry/2022/05/22/204535

## カプセル化
型としてのオブジェクト指向の文脈でエンティティや値オブジェクトでの値と振る舞い（計算・判断）を型のメソッドとして記述します。
関連する値と振る舞い（計算・判断）が一つの型にまとめられることで、どこに何が書いてあるかがわかりやすくなります。
値オブジェクトと同様に、値の振る舞いがコードで表現することができます。

```go
type Completed struct {
	value bool
}
func (c Completed) ToIncompleted() *Completed {
	return NewCompleted(false)
}
```

参考：
ドメイン駆動設計を理解する３つのキーワード
https://masuda220.hatenablog.com/entry/2019/03/04/144154






